<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ultimate XO - Mobile + Restart</title>
<style>
  :root{
    --gap: 8px;
    --board-bg: #111;
    --mini-bg: #222;
    --cell-bg: #444;
    --cell-hover: #555;
    --win-color: #27ae60;
    --active-glow: rgba(0,255,204,0.15);
    /* cell size responsive: choose smaller of 70px and 12.5vw (so it fits on mobile) */
    --cell-size: min(70px, 12.5vw);
  }

  *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    gap:12px;
    padding:16px;
    background: linear-gradient(180deg,#060606,#0b0b0b 40%);
    color:#fff;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  header{width:100%; display:flex; align-items:center; justify-content:space-between; gap:12px;}
  h1{font-size:18px; margin:0; padding:0; text-align:center;}
  .controls{display:flex; gap:8px; align-items:center;}

  button{
    background:#0ea5a0;
    border:none;
    padding:8px 12px;
    border-radius:8px;
    color:#042;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 4px 10px rgba(0,0,0,0.4);
  }
  button:active{transform:translateY(1px);}

  .status{
    font-size:14px;
    color:#bfeee6;
    text-align:center;
    min-width:180px;
  }

  /* big board container */
  .big-board{
    display:grid;
    grid-template-columns: repeat(3, auto);
    gap: var(--gap);
    background: var(--board-bg);
    padding: var(--gap);
    border-radius:12px;
    width: min(96vw, 560px);
    max-width:560px;
  }

  /* mini board */
  .board{
    position:relative;
    display:grid;
    grid-template-columns: repeat(3, var(--cell-size));
    grid-template-rows: repeat(3, var(--cell-size));
    gap: 6px;
    background: var(--mini-bg);
    padding:8px;
    border-radius:10px;
    transition: transform .15s ease, box-shadow .15s ease, opacity .15s;
    touch-action: manipulation;
  }

  /* mini-board winner overlay (big X/O) */
  .board.winner::after{
    content: attr(data-winner);
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: calc(var(--cell-size) * 1.6);
    font-weight:900;
    color: #fff;
    text-shadow: 0 6px 18px rgba(0,0,0,0.7);
    pointer-events:none;
  }

  .board.disabled{ opacity:0.58; pointer-events:none; }

  .board.active-board{
    box-shadow: 0 8px 30px var(--active-glow);
    transform: scale(1.03);
  }

  .cell{
    width: var(--cell-size);
    height: var(--cell-size);
    background: var(--cell-bg);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: calc(var(--cell-size) * 0.5);
    font-weight:800;
    border-radius:8px;
    cursor: pointer;
    user-select: none;
    -webkit-user-select:none;
    transition: background .12s ease, transform .08s ease;
    touch-action: manipulation;
  }
  .cell:active{ transform: scale(.98); }
  .cell:hover{ background: var(--cell-hover); }

  /* highlight winning mini-board */
  .board.winner{
    background: linear-gradient(180deg, rgba(39,174,96,0.95), rgba(20,110,60,0.95));
  }

  .winner-display{
    margin-top:6px;
    font-size:15px;
    min-height:22px;
    color:#d1ffe8;
    text-align:center;
  }

  /* small screens: reduce gaps */
  @media (max-width:420px){
    :root{ --gap:6px; --cell-size: min(64px, 14vw); }
    .status{ font-size:13px; min-width:140px; }
    h1{ font-size:16px; }
  }

  /* landscape phones: allow wider layout shrink */
  @media (orientation:landscape) and (max-width:800px){
    :root{ --cell-size: min(56px, 11vw); }
    body{ padding:8px; }
  }
</style>
</head>
<body>

<header>
  <h1>Ultimate XO - Mobile</h1>
  <div class="controls">
    <div class="status" id="status">Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø¢Ù†: X</div>
    <button id="restartBtn" aria-label="Restart game">Restart</button>
  </div>
</header>

<main>
  <div class="big-board" id="bigBoard" role="grid" aria-label="Ultimate Tic Tac Toe board"></div>
  <div class="winner-display" id="winnerDisplay" aria-live="polite"></div>
</main>

<script>
/* --- State --- */
const bigBoard = document.getElementById('bigBoard');
const statusEl = document.getElementById('status');
const winnerDisplay = document.getElementById('winnerDisplay');
const restartBtn = document.getElementById('restartBtn');

let currentPlayer = 'X';
let boardWinners = Array(9).fill(null);
let nextBoard = null; // if null => player free to play anywhere (except finished boards)

/* --- create boards and cells --- */
function createGame(){
  bigBoard.innerHTML = '';
  boardWinners = Array(9).fill(null);
  nextBoard = null;
  currentPlayer = 'X';
  winnerDisplay.textContent = '';
  statusEl.textContent = `Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø¢Ù†: ${currentPlayer}`;

  for(let b=0;b<9;b++){
    const board = document.createElement('div');
    board.className = 'board';
    board.dataset.index = b;
    board.setAttribute('role','grid');
    board.setAttribute('aria-label',`mini board ${b+1}`);

    for(let c=0;c<9;c++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.dataset.board = b;
      cell.dataset.cell = c;
      cell.setAttribute('role','button');
      cell.setAttribute('aria-label',`cell ${c+1} of board ${b+1}`);
      cell.addEventListener('click', onCellClick, {passive:true});
      board.appendChild(cell);
    }
    bigBoard.appendChild(board);
  }

  updateActiveBoards();
}

/* --- game logic --- */
function onCellClick(e){
  const cell = e.currentTarget;
  const bIndex = Number(cell.dataset.board);
  const cIndex = Number(cell.dataset.cell);
  const boardEl = document.querySelector(`.board[data-index="${bIndex}"]`);

  // ignore if not allowed
  if(cell.textContent) return;
  if(boardWinners[bIndex]) return;
  if(nextBoard !== null && nextBoard !== bIndex && !isBoardFull(nextBoard)) {
    // not allowed to play here
    // small feedback: briefly flash the allowed board(s)
    flashActive();
    return;
  }

  // place
  cell.textContent = currentPlayer;

  // check mini-board victory
  const cells = Array.from(boardEl.querySelectorAll('.cell')).map(x => x.textContent || '');
  const miniWin = checkWinner(cells);
  if(miniWin){
    boardEl.classList.add('winner');
    boardEl.dataset.winner = currentPlayer;
    boardWinners[bIndex] = currentPlayer;
    disableBoard(boardEl);
  }

  // check global victory
  if(checkWinner(boardWinners)){
    winnerDisplay.textContent = `ðŸŽ‰ Ø§Ù„Ù„Ø§Ø¹Ø¨ ${currentPlayer} Ø±Ø¨Ø­ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©!`;
    statusEl.textContent = `Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©`;
    disableAll();
    return;
  }

  // set nextBoard from cell index (the position chosen)
  nextBoard = cIndex;
  // if nextBoard already won or full -> reset to free choice
  if(boardWinners[nextBoard] || isBoardFull(nextBoard)){
    nextBoard = null;
  }

  // switch player
  currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
  statusEl.textContent = `Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø¢Ù†: ${currentPlayer}`;
  updateActiveBoards();
}

/* --- helpers --- */
function checkWinner(arr){
  // arr length 9 (can contain null/""), returns true if there's a winner (note: for global we store X/O/null)
  const wins = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  return wins.some(([a,b,c]) => {
    return arr[a] && arr[a] === arr[b] && arr[a] === arr[c];
  });
}

function isBoardFull(i){
  const board = document.querySelector(`.board[data-index="${i}"]`);
  if(!board) return false;
  return Array.from(board.querySelectorAll('.cell')).every(c => c.textContent);
}

function disableBoard(boardEl){
  boardEl.classList.add('disabled');
  boardEl.querySelectorAll('.cell').forEach(x => x.style.pointerEvents = 'none');
}

function disableAll(){
  document.querySelectorAll('.cell').forEach(x => x.style.pointerEvents = 'none');
  document.querySelectorAll('.board').forEach(b => b.classList.add('disabled'));
}

/* Highlight active boards */
function updateActiveBoards(){
  document.querySelectorAll('.board').forEach(b => {
    b.classList.remove('active-board');
    // remove disabled if not winner (restart case)
    if(!b.classList.contains('winner')) b.classList.remove('disabled');
  });

  if(nextBoard === null){
    // all unfinished boards active
    document.querySelectorAll('.board').forEach(b => {
      if(!b.classList.contains('winner')) b.classList.add('active-board');
    });
  } else {
    const target = document.querySelector(`.board[data-index="${nextBoard}"]`);
    if(target && !target.classList.contains('winner')){
      target.classList.add('active-board');
      // make other unfinished boards less prominent but still accessible visually
      document.querySelectorAll('.board').forEach(b => {
        if(b !== target && !b.classList.contains('winner')) b.classList.remove('active-board');
      });
    } else {
      // fallback: free play
      nextBoard = null;
      updateActiveBoards();
    }
  }
}

/* small feedback when player clicks wrong board */
function flashActive(){
  const active = document.querySelectorAll('.board.active-board');
  active.forEach(b => {
    b.style.transition = 'box-shadow .08s';
    b.style.boxShadow = '0 0 0 8px rgba(0,255,204,0.06)';
    setTimeout(()=> b.style.boxShadow = '', 220);
  });
}

/* Restart game */
function restartGame(){
  createGame();
}

/* init + bind */
restartBtn.addEventListener('click', restartGame, {passive:true});
createGame();

</script>
</body>
</html>
